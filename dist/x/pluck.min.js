/**
 * rubico v1.9.6
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2021 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */

!function(n,t){"object"==typeof module?module.exports=t:"function"==typeof define?define((()=>t)):n.pluck=t}("object"==typeof globalThis?globalThis:this,function(){"use strict";const n=n=>null!=n&&"function"==typeof n.then,t=(t,r)=>function(...o){const e=t(...o);return n(e)?e.then(r):r(e)},r=Symbol.iterator,o=(n,t)=>({toString:()=>"[object MappingIterator]",[r](){return this},next(){const r=n.next();return r.done?r:{value:t(r.value),done:!1}}}),e=n=>({value:n,done:!1}),c=Symbol.asyncIterator,u=(t,r)=>({[c](){return this},async next(){const o=await t.next();if(o.done)return o;const c=r(o.value);return n(c)?c.then(e):{value:c,done:!1}}}),i=Symbol.for("placeholder"),f=function(n,t,r){return t==i?((n,t)=>function(r){return n(r,t)})(n,r):((n,t)=>function(r){return n(t,r)})(n,t)},s=Array.isArray,l=Object.prototype.toString,a=n=>l.call(n),h=Promise.all.bind(Promise),p=function(t,r){const o=t.length,e=Array(o);let c=-1,u=!1;for(;++c<o;){const o=r(t[c],c,t);n(o)&&(u=!0),e[c]=o}return u?h(e):e},y=function(n,t,r,o){return t==i?((n,t,r)=>function(o){return n(o,t,r)})(n,r,o):r==i?((n,t,r)=>function(o){return n(t,o,r)})(n,t,o):((n,t,r)=>function(o){return n(t,r,o)})(n,t,r)},d=(n,t,r)=>n[t](r),g=n=>function(){return n},w=function(n,t,r,o,e){return t==i?((n,t,r,o)=>function(e){return n(e,t,r,o)})(n,r,o,e):r==i?((n,t,r,o)=>function(e){return n(t,e,r,o)})(n,t,o,e):o==i?((n,t,r,o)=>function(e){return n(t,r,e,o)})(n,t,r,e):((n,t,r,o)=>function(e){return n(t,r,o,e)})(n,t,r,o)},b=(n,t,r,o)=>n[t](r,o),j=t=>new Promise((t=>function(r){const o={};let e=0;for(const c in t){const u=t[c];n(u)?(e+=1,u.then((n=>function(t){o[n]=t,e-=1,0==e&&r(o)})(c))):o[c]=u}0==e&&r(o)})(t)),m=function(n,t,r){return n[t]=r,n},A=async function(t,r,o,e){const c=t.length;for(;++e<c;){const c=r(t[e]);o[e]=n(c)?await c:c}return o},v=n=>function(...t){return n(...t),t[0]},S=Promise.race.bind(Promise),M=async function(t,r,o,e,c,u){const i=t.length;for(;++c<i;){u.size>=o&&await S(u);const i=r(t[c]);if(n(i)){const n=i.then(v((()=>u.delete(n))));u.add(n),e[c]=n}else e[c]=i}return h(e)},O=Object.prototype.hasOwnProperty,T=(n,t)=>O.call(n,t),E=(n,t,r)=>function(...o){const e=r.length,c=o.length,u=[];let f=-1,s=-1,l=0;for(;++f<e;){const e=r[f];if(e==i&&(s+=1)<c){const n=o[s];n==i&&(l+=1),u.push(n)}else u.push(e);if(u.length==n)return 0==l?t(...u):x(n,t,u)}for(;++s<c;){const r=o[s];if(r==i&&(l+=1),u.push(r),u.length==n)return 0==l?t(...u):x(n,t,u)}return x(n,t,u)},x=function(n,t,r){const o=r.length;if(o<n)return E(n,t,r);let e=-1;for(;++e<o;){if(r[e]==i)return E(n,t,r)}return t(...r)},P=n=>function([t,r]){return n(t,r)},$=function(n,t,r){return n.set(t,r)},I=function(t,r){const o=new Map,e=[];return t.forEach(((t,r,o)=>function(e,c){const u=t([c,e]);n(u)?o.push(u.then(P(x(3,$,[r])))):r.set(u[0],u[1])})(r,o,e)),0==e.length?o:h(e).then(g(o))},z=function(t,e){return s(t)?p(t,e):"function"==typeof t?(n=>"[object GeneratorFunction]"==a(n))(t)?((n,t)=>function*(...r){for(const o of n(...r))yield t(o)})(t,e):(n=>"[object AsyncGeneratorFunction]"==a(n))(t)?function(n,t){return async function*(...r){for await(const o of n(...r))yield t(o)}}(t,e):((t,r)=>function(o,e){const c=r(e);return n(c)?c.then(f(t,o,i)):t(o,c)})(t,e):null==t?t:"function"==typeof t.then?t.then(e):"function"==typeof t.map?t.map(e):"string"==typeof t||t.constructor==String?function(t,r){const o=p(t,r);return n(o)?o.then(y(d,i,"join","")):o.join("")}(t,e):t.constructor==Set?function(t,r){const o=new Set,e=[];for(const c of t){const u=r(c,c,t);n(u)?e.push(u.then(y(d,o,"add",i))):o.add(u)}return 0==e.length?o:h(e).then(g(o))}(t,e):t.constructor==Map?function(t,r){const o=new Map,e=[];for(const[c,u]of t){const f=r(u,c,t);n(f)?e.push(f.then(w(b,o,"set",c,i))):o.set(c,f)}return 0==e.length?o:h(e).then(g(o))}(t,e):"function"==typeof t[r]?o(t[r](),e):"function"==typeof t[c]?u(t[c](),e):t.constructor==Object?function(t,r){const o={};let e=!1;for(const c in t){const u=r(t[c],c,t);n(u)&&(e=!0),o[c]=u}return e?j(o):o}(t,e):e(t)},F=(...n)=>{const t=n.pop();return n.length>0?z(n[0],t):f(z,i,t)};F.entries=function(t){return function(r){if(null==r)throw new TypeError("value is not an Object or Map");if(r.constructor==Object)return function(t,r){const o={},e=[];for(const c in t){const u=r([c,t[c]]);n(u)?e.push(u.then(P(x(3,m,[o])))):o[u[0]]=u[1]}return 0==e.length?o:h(e).then(g(o))}(r,t);if(r.constructor==Map)return I(r,t);throw new TypeError("value is not an Object or Map")}},F.series=r=>function(o){if(s(o))return function(r,o){const e=r.length,c=Array(e);let u=-1;for(;++u<e;){const e=o(r[u]);if(n(e))return e.then(t(y(m,c,u,i),w(A,r,o,i,u)));c[u]=e}return c}(o,r);throw new TypeError(`${o} is not an Array`)},F.pool=(t,r)=>function(o){if(s(o))return function(t,r,o){const e=t.length,c=Array(e);let u=-1;for(;++u<e;){const e=r(t[u]);if(n(e)){const n=new Set,i=e.then(v((()=>n.delete(i))));return n.add(i),c[u]=i,M(t,r,o,c,u,n)}c[u]=e}return c}(o,r,t);throw new TypeError(`${o} is not an Array`)},F.withIndex=t=>function(r){if(s(r))return function(t,r){const o=t.length,e=Array(o);let c=-1,u=!1;for(;++c<o;){const o=r(t[c],c,t);n(o)&&(u=!0),e[c]=o}return u?h(e):e}(r,t);throw new TypeError(`${r} is not an Array`)},F.own=t=>function(r){if((n=>{if(null==n)return!1;const t=typeof n;return"object"==t||"function"==t})(r)&&!s(r))return function(t,r){const o={};let e=!1;for(const c in t)if(T(t,c)){const u=r(t[c]);n(u)&&(e=!0),o[c]=u}return e?j(o):o}(r,t);throw new TypeError(`${r} is not an Object`)};const G=/[.|[|\]]+/,k=function(n,t){const r=new Map,o=function(o){if(r.has(o))return r.get(o);const e=n(o);return r.set(o,e),r.size>t&&r.clear(),e};return o.cache=r,o}((function(n){const t=n.length-1,r="["==n[0],o="]"==n[t];return r&&o?n.slice(1,t).split(G):r?n.slice(1).split(G):o?n.slice(0,t).split(G):n.split(G)}),500),q=function(n,t){const r=(n=>s(n)?n:"string"==typeof n?k(n):[n])(t),o=r.length;let e=-1,c=n;for(;++e<o;)if(c=c[r[e]],null==c)return;return c};return t(((n,t)=>function(r){const o=null==r?void 0:q(r,n);return void 0===o?"function"==typeof t?t(r):t:o}),F)}());
